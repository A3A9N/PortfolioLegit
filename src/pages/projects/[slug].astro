---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ProjectDetailHeader from '../../components/ProjectDetailHeader.astro';
import AnimatedSection from '../../components/AnimatedSection.astro';
import type { Project } from '../../data/projects';
import { projects } from '../../data/projects';

export async function getStaticPaths() {
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

interface Props {
  project: Project;
}

const { project } = Astro.props as Props;
---

<BaseLayout title={project.title} description={project.shortDescription}>
  <div class="page-shell">
    <Header />

    <main class="flex-1 pb-16">
      <ProjectDetailHeader project={project} />

      <AnimatedSection as="section">
        <div class="page-container grid gap-10 md:grid-cols-[minmax(0,1.6fr)_minmax(0,1.1fr)]">
          <div class="space-y-8">
            <!-- Preview Section -->
            {(() => {
              const isVideoProject = project.slug === 'cuphead-vertical-slice' || project.slug === 'bossfight-prototype';
              const previewGif = `/projects/${project.slug}/preview.gif`;
              const previewVideo = `/projects/${project.slug}/preview.mp4`;
              
              return (
                <div class="card overflow-hidden">
                  <div class="relative aspect-video">
                    {isVideoProject ? (
                      <video
                        class="h-full w-full object-cover"
                        controls
                        autoplay
                        loop
                        muted
                        playsinline
                        preload="metadata"
                        poster={project.thumbnail}
                      >
                        <source src={previewVideo} type="video/mp4" />
                        Your browser does not support the video tag.
                      </video>
                    ) : (
                      <img
                        src={previewGif}
                        alt={`${project.title} preview`}
                        class="h-full w-full object-cover"
                        loading="eager"
                      />
                    )}
                  </div>
                </div>
              );
            })()}

            <!-- Showreel Video (if available) -->
            {project.showreel && (
              <div class="card overflow-hidden">
                <div class="relative aspect-video">
                  <video
                    class="h-full w-full object-cover"
                    controls
                    preload="metadata"
                    poster={project.thumbnail}
                  >
                    <source src={project.showreel} type="video/mp4" />
                    Your browser does not support the video tag.
                  </video>
                </div>
              </div>
            )}

            {project.artGifs && project.artGifs.length > 0 && (
              <div class="card overflow-hidden">
                <div class="flex items-center justify-between border-b border-white/10 px-5 py-4">
                  <p class="text-xs font-semibold uppercase tracking-[0.22em] text-slate-400">Art</p>
                </div>
                <div class="grid gap-3 p-3 md:grid-cols-1">
                  {project.artGifs.map((src) => (
                    <div class="relative overflow-hidden rounded-xl bg-slate-900/70 aspect-video">
                      <img
                        src={src}
                        loading="lazy"
                        alt={`${project.title} art`}
                        class="h-full w-full object-contain"
                      />
                    </div>
                  ))}
                </div>
              </div>
            )}

            {project.codeGifs && project.codeGifs.length > 0 && (
              <div class="card overflow-hidden">
                <div class="flex items-center justify-between border-b border-white/10 px-5 py-4">
                  <p class="text-xs font-semibold uppercase tracking-[0.22em] text-slate-400">Code</p>
                </div>
                <div class="grid gap-3 p-3 md:grid-cols-1">
                  {project.codeGifs.map((src) => (
                    <div class="relative overflow-hidden rounded-xl bg-slate-900/70 aspect-video">
                      <img
                        src={src}
                        loading="lazy"
                        alt={`${project.title} code`}
                        class="h-full w-full object-contain"
                      />
                    </div>
                  ))}
                </div>
              </div>
            )}

            <section class="space-y-4">
              <h2 class="text-sm font-semibold tracking-[0.18em] uppercase text-slate-400">
                Overview
              </h2>
              <p class="text-sm text-slate-200">
                {project.description}
              </p>
            </section>

            <section class="space-y-3">
              <h2 class="text-sm font-semibold tracking-[0.18em] uppercase text-slate-400">
                Features
              </h2>
              <ul class="space-y-2 text-sm text-slate-200">
                {project.features.map((feature) => (
                  <li>• {feature}</li>
                ))}
              </ul>
            </section>
          </div>

          <aside class="space-y-8">
            <section class="card p-5">
              <h3 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
                My contribution
              </h3>
              <ul class="mt-3 space-y-2 text-sm text-slate-200">
                {project.contribution.map((item) => (
                  <li>• {item}</li>
                ))}
              </ul>
            </section>

            <section class="card p-5">
              <h3 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
                Code snippets
              </h3>
              <div class="mt-3 space-y-4">
                {project.codeSnippets.map((snippet) => (
                  <div class="space-y-2">
                    <p class="text-xs font-medium text-slate-200">{snippet.title}</p>
                    <pre class="max-h-64 overflow-auto rounded-xl bg-black/70 p-3 text-xs text-slate-100">
{snippet.code}
                    </pre>
                  </div>
                ))}
              </div>
            </section>

            <section class="card p-5">
              <h3 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
                Repository
              </h3>
              <a
                href={project.github}
                class="mt-3 inline-flex text-xs font-semibold uppercase tracking-[0.2em] text-sky-300 hover:text-sky-200"
              >
                Open on GitHub
              </a>
            </section>
          </aside>
        </div>
      </AnimatedSection>
    </main>

    <Footer />
  </div>
</BaseLayout>


